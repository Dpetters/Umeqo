<!--
Developers : Joshua Ma,
All code is property of original developers.
Copyright 2011. All Rights Reserved.
-->
{% extends "base.html" %}

{% block title %}
| {{event.name}}
{% endblock %}

{% block metadata %}
<!--open graph, FB meta tags -->
<meta property="og:title" content="{{event.name}}" />
<meta property="og:type" content="website" />
<meta property="og:url" content="{{page_url}}" />
<meta property="og:image" content="{{company_logo}}" />
<meta property="og:site_name" content="Umeqo" />
<meta property="fb:admins" content="502728220" />

<link rel="stylesheet" href="{{ STATIC_URL }}css/events/event_page.css" />
<script src="{{ STATIC_URL }}javascript/events/event_page.js"></script>
<script type="text/javascript">
var EVENT_RSVP_URL = "{% url event_rsvp id=event.id %}";
var EVENT_UNRSVP_URL = "{% url event_unrsvp id=event.id %}";
var CHECKIN_URL = "{% url event_checkin id=event.id %}";
</script>
{% endblock %}

{% block content_area %}
{% include "event_checkin.html" with event=event %}
<div id="event_page_block" class="main_block">
    <div class="main_block_header">
        <img class="main_block_header_icon" src="{{ STATIC_URL }}images/icons/calendar.png" />
        <span class="main_block_header_title">{{event.name}}</span>
        {% if user.is_authenticated %}
            {% if show_admin %}
                <a href="{% url employer_edit_event id=event.id %}" class=" main_block_header_sidelink button sub-button">Edit Event</a>
            {% endif %}
            {% if user.student %}
                <a href="{% url events_list %}" class="main_block_header_sidelink button sub-button">Event List</a>
            {% else %}
                <a href="{% url home %}#events" class="main_block_header_sidelink button sub-button">Back to Events</a>
            {% endif %}
        {% endif %}
    </div>
    <div class="main_block_content">
        {% if show_admin %}
        <div class="clearfix"></div>
        <div id="event_admin">
            <h1>Event Admin (visible only to you)</h1>
            <div id="event_rsvps">
                <table id="event_numbers">
                    <tr>
                        <td class="number">{{rsvps|length}}</td>
                        <td class="number_label">attending</td>
                    </tr>
                    <tr>
                        <td class="number">{{event.view_count}}</td>
                        <td class="number_label">pageview{{event.view_count|pluralize}}</td>
                    </tr>
                </table>
                <h2>Attending Students</h2>
                {% for student in rsvps %}
                <div class="event_rsvp" id="{{student.id}}">
                    {{student.first_name}} {{student.last_name}}
                    <form id="f-{{student.id}}" action="{% url employer_students %}" method="POST" target="_blank">
                        {% csrf_token %}
                        <input type="hidden" name="query" value="{{student.first_name}} {{student.last_name}}" />
                    </form>
                </div>
                {% empty %}
                <div id="event_rsvps_empty">There are no RSVPs yet.</div>
                {% endfor %}
            </div>
            <div class="clearfix"></div>
        </div>
        {% endif %}
        <div id="event_side">
            <div id="logo">
                <img src="{{company_logo}}" alt="company logo" />
            </div>
            <div id="event_actions">
                <div id="like-button">
                    <fb:like href="" send="true" layout="box_count" width="100" show_faces="true"></fb:like>
                </div>
                <div id="rsvp_div">
                    {% if show_admin or is_past %}
                        <a href="javascript:void(0)" id="attending-button" class="button disabled-button" title="RSVP disabled.">
                            {% if is_past %}
                                Event already passed!
                            {% else %}
                                RSVP: Attending
                            {% endif %}
                        </a>
                        {% if show_admin %}
                        <span class="help-bubble">Students can click to RSVP.</span>
                        {% endif %}
                    {% else %}{% if can_rsvp %}
                        {% if attending %}
                        <span id="attending-span">Attending</span>
                        <a href="{% url event_unrsvp id=event.id %}" id="not-attending-button">RSVP: Not attending</a>
                        {% else %}
                        <a href="{% url event_rsvp id=event.id %}" id="attending-button" class="button">RSVP: Attending</a>
                        {% endif %}
                    {% endif %}{% endif %}
                    {% if not user.is_authenticated %}
                        <a href="javascript:void(0)" id="attending-button" class="button disabled-button" title="RSVP disabled.">
                            Login to RSVP.
                        </a>
                    {% endif %}
                </div>
                <a class="google-button" href="http://www.google.com/calendar/event?action=TEMPLATE&text={{event.name|urlencode}}{% if not event.start_datetime %}%20({{event.end_datetime|date:"g:i A"}}){% endif %}&dates={% if event.start_datetime %}{{event.start_datetime|date:"Ymd\THis\Z"}}/{{event.end_datetime|date:"Ymd\THis"}}{% else %}{{event.end_datetime|date:"Ymd"}}/{{event.end_datetime|date:"Ymd"}}{% endif %}&sprop=www.{{DOMAIN}}&sprop=name:Umeqo&details={{google_description|urlencode}}&location={{event.location|urlencode}}">
                    <img src="http://buttons.googlesyndication.com/fusion/add.gif" alt="Add to Google"/>
                </a>
            </div>
        </div>
        <table id="event_details">
            <tr>
                <th>Time:</th>
                <td>
                {% if event.start_datetime %}
                <span class="start">{{event.start_datetime|date:"D, F j"}}
                {% endif %}
                <span class="end">
                    {% ifequal event.start_datetime.day event.end_datetime.day %}
                    {% ifequal event.start_datetime.month event.end_datetime.month %}
                    {% ifequal event.start_datetime.year event.end_datetime.year %}
                        from {{event.start_datetime|date:"h:i A"}}</span> -
                        {{event.end_datetime|date:"h:i A"}}
                    {% endifequal %}{% endifequal %}
                    {% else %}
                        {% if event.start_datetime %}</span> - {% endif %}
                        {{event.end_datetime|date:"D, F j h:i A"}}
                    {% endifequal %}
                </span>
                </td>
            </tr>
            <tr>
                <th>Place:</th>
                <td>{{event.location}}</td>
            </tr>
            <tr>
                <th>Created by:</th>
                <td>
                    {% for recruiter in recruiters %}
                        <a href="{% url employers_list %}?id={{recruiter.employer.id}}" class="employer">{{recruiter.employer.name}}</a>
                    {% endfor %}
                </td>
            </tr>
            <tr>
                <th>Description:</th>
                <td>{% if event.description %}{{event.description}}{% else %}No description provided.{% endif %}</td>
            </tr>
            {% if audience %}
            <tr>
                <th>Audience:</th>
                <td>
                    <ul>
                    {% for a in audience %}
                        <li>{{a}}</li>
                    {% endfor %}
                    </ul>
                </td>
            </tr>
            {% endif %}
        </table>
        {% if show_admin %}
        <div id="event_signin">
            <h3>Event signin mode</h3>
            <a id="event_signin_link" href="#">
                <span class="text">Enable</span>
                <span class="filler"></span>
            </a>
        </div>
        {% endif %}
    </div>
</div>
<div id="fb-root"></div>
<script>
  window.fbAsyncInit = function() {
    FB.init({appId: '119497238132973', status: true, cookie: true,
             xfbml: true});
  };
  (function() {
    var e = document.createElement('script'); e.async = true;
    e.src = document.location.protocol +
      '//connect.facebook.net/en_US/all.js';
    document.getElementById('fb-root').appendChild(e);
  }());
</script>
{% endblock %}
